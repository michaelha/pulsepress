/**
 * Plugin Name: areacomplete
 * Author: Amir Harel & Sean Templeton
 * Copyright: amir harel (harel.amir1@gmail.com)
 * Twitter: @amir_harel
 * Version 1.4.1
 * Published at : http://www.amirharel.com/2011/03/07/implementing-autocomplete-jquery-plugin-for-textarea/
 */
(function(e){e.fn.areacomplete=function(u){if(typeof e.browser.msie!="undefined"){u.mode="outter"}this.each(function(v,w){if(w.nodeName=="TEXTAREA"){p(w,u)}})};var t={isChrome:e.browser.webkit};function q(u){var y=u;if(document.selection){var x=document.selection.createRange().getBookmark();var w=y.createTextRange();w.moveToBookmark(x);var v=y.createTextRange();v.collapse(true);v.setEndPoint("EndToStart",w);return v.text.length+w.text.length}return y.selectionEnd}function m(){return{"`":0,"~":0,"1":0,"!":0,"2":0,"@":0,"3":0,"#":0,"4":0,"$":0,"5":0,"%":0,"6":0,"^":0,"7":0,"&":0,"8":0,"*":0,"9":0,"(":0,"0":0,")":0,"-":0,_:0,"=":0,"+":0,q:0,Q:0,w:0,W:0,e:0,E:0,r:0,R:0,t:0,T:0,y:0,Y:0,u:0,U:0,i:0,I:0,o:0,O:0,p:0,P:0,"[":0,"{":0,"]":0,"}":0,a:0,A:0,s:0,S:0,d:0,D:0,f:0,F:0,g:0,G:0,h:0,H:0,j:0,J:0,k:0,K:0,l:0,L:0,";":0,":":0,"'":0,'"':0,"\\":0,"|":0,z:0,Z:0,x:0,X:0,c:0,C:0,v:0,V:0,b:0,B:0,n:0,N:0,m:0,M:0,",":0,"<":0,".":0,">":0,"/":0,"?":0," ":0}}function s(w){for(var u in w.chars){if(u==" "){e(w.clone).html("<span id='test-width_"+w.id+"' style='line-block'>&nbsp;</span>")}else{e(w.clone).html("<span id='test-width_"+w.id+"' style='line-block'>"+u+"</span>")}var v=e("#test-width_"+w.id).width();w.chars[u]=v}}var l={};var r=0;function p(u,v){r++;l[r]={id:"auto_"+r,ta:u,wordCount:v.wordCount,on:v.on,clone:null,lineHeight:0,list:null,charInLines:{},mode:v.mode,chars:m()};var w=f(r);l[r].clone=w;s(l[r]);l[r].list=c(l[r]);i(l[r])}function c(v){var u=document.createElement("ul");e(u).addClass("auto-list");document.body.appendChild(u);return u}function f(x){var u=l[x];var w=document.createElement("div");var v=e(u.ta).offset();v.top=v.top-parseInt(e(u.ta).css("margin-top"));v.left=v.left-parseInt(e(u.ta).css("margin-left"));e(w).css({position:"absolute",top:v.top,left:v.left,"border-collapse":e(u.ta).css("border-collapse"),"border-bottom-style":e(u.ta).css("border-bottom-style"),"border-bottom-width":e(u.ta).css("border-bottom-width"),"border-left-style":e(u.ta).css("border-left-style"),"border-left-width":e(u.ta).css("border-left-width"),"border-right-style":e(u.ta).css("border-right-style"),"border-right-width":e(u.ta).css("border-right-width"),"border-spacing":e(u.ta).css("border-spacing"),"border-top-style":e(u.ta).css("border-top-style"),"border-top-width":e(u.ta).css("border-top-width"),direction:e(u.ta).css("direction"),"font-size-adjust":e(u.ta).css("font-size-adjust"),"font-size":e(u.ta).css("font-size"),"font-stretch":e(u.ta).css("font-stretch"),"font-style":e(u.ta).css("font-style"),"font-family":e(u.ta).css("font-family"),"font-variant":e(u.ta).css("font-variant"),"font-weight":e(u.ta).css("font-weight"),width:e(u.ta).css("width"),height:e(u.ta).css("height"),"letter-spacing":e(u.ta).css("letter-spacing"),"margin-bottom":e(u.ta).css("margin-bottom"),"margin-top":e(u.ta).css("margin-top"),"margin-right":e(u.ta).css("margin-right"),"margin-left":e(u.ta).css("margin-left"),"padding-bottom":e(u.ta).css("padding-bottom"),"padding-top":e(u.ta).css("padding-top"),"padding-right":e(u.ta).css("padding-right"),"padding-left":e(u.ta).css("padding-left"),"overflow-x":"hidden","line-height":e(u.ta).css("line-height"),"overflow-y":"hidden","z-index":-10});u.chromeWidthFix=(u.ta.clientWidth-e(u.ta).width());u.lineHeight=e(u.ta).css("line-height");if(isNaN(parseInt(u.lineHeight))){u.lineHeight=parseInt(e(u.ta).css("font-size"))+2}document.body.appendChild(w);return w}function b(v){var x=q(v.ta);var y=v.ta.value;y=y.substr(0,x);if(y.charAt(y.length-1)==" "||y.charAt(y.length-1)=="\n"){return""}var u=[];var w=0;var z=y.length-1;while(w<v.wordCount&&z>=0&&y.charAt(z)!="\n"){u.unshift(y.charAt(z));z--;if(y.charAt(z)==" "||z<0){w++}}return u.join("")}function h(w,D,x){if(!w.listVisible){w.listVisible=true;var A=g(w);e(w.list).css({left:A.left+"px",top:A.top+"px",display:"block"})}var C,B,z;var E=new RegExp("("+D+")");var y=e(w.ta).width()-5;var u=w.mode=="outter"?y:"";e(w.list).empty();for(var v=0;v<x.length;v++){z={};if(typeof x[v]=="string"){B=x[v]}else{B=x[v].value;z=x[v].data}e(w.list).append(e("<li>").css("width",u+"px").attr({"data-value":B}).html(B.replace(E,"<mark>$1</mark>")).data(z))}}function j(E,y){var G=[];var w=e(y.clone).width();var D="";var B=0;var v=0;var C="";var A=y.chars;var z=E.length;for(var x=0;x<z;x++){var u=E.charAt(x);C+=u.replace(" ","&nbsp;");var F=(typeof A[u]=="undefined")?0:A[u];v+=F;if(u==" "||u=="-"){if(B+v<w-1){D=D+C;B=B+v;C="";v=0}else{G.push(D);D=C;B=v;C="";v=0}}if(u=="\n"){if(B+v<w-1){G.push(D+C)}else{G.push(D);G.push(C)}D="";C="";B=0;v=0}}if(B+v<w-1){G.push(D+C)}else{G.push(D);G.push(C)}return G}function g(y){if(y.mode=="outter"){return a(y)}if(t.isChrome){e(y.clone).width(y.ta.clientWidth-y.chromeWidthFix)}else{e(y.clone).width(y.ta.clientWidth)}var z=y.ta;var D=q(y.ta);var C=z.value;var u=C.substr(0,D);var A=C.substr(D,C.length);var E=j(u,y);var v=e(y.clone);v.html("");for(var x=0;x<E.length-1;x++){v.append("<div style='height:"+(parseInt(y.lineHeight))+"px;'>"+E[x]+"</div>")}v.append("<span id='"+y.id+"' style='display:inline-block;'>"+E[E.length-1]+"</span>");v.append("<span id='rest' style='max-width:'"+y.ta.clientWidth+"px'>"+A.replace(/\n/g,"<br/>")+"&nbsp;</span>");v.get(0).scrollTop=z.scrollTop;var B=v.children("#"+y.id);var w=B.offset();return{top:w.top+B.height(),left:w.left+B.width()}}function a(u){var v=e(u.ta).offset();return{top:v.top+e(u.ta).height()+8,left:v.left}}function n(u){if(u.listVisible){e(u.list).css("display","none");u.listVisible=false}}function o(u,w){var v=e(w.list).find("[data-selected=true]");if(v.length!=1){if(u>0){e(w.list).find("li:first-child").attr("data-selected","true")}else{e(w.list).find("li:last-child").attr("data-selected","true")}return}v.attr("data-selected","false");if(u>0){v.next().attr("data-selected","true")}else{v.prev().attr("data-selected","true")}}function k(v){var u=e(v.list).find("[data-selected=true]");if(u.length==1){return u.get(0)}return null}function d(B,w){var v=e(B).attr("data-value");var D=q(w.ta);var C=w.ta.value;C=C.substr(0,D);var A=0;var y=C.length-1;while(A<w.wordCount&&y>=0&&C.charAt(y)!="\n"){y--;if(C.charAt(y)==" "||y<0){A++}}var z=w.ta.value.substr(0,y+1);var x=w.ta.value.substr(D,w.ta.value.length);var u=w.ta.scrollTop;if(w.on&&w.on.selected){var E=w.on.selected(v,e(B).data())}if(E){v=E}w.ta.value=z+v+x;w.ta.scrollTop=u;w.ta.selectionEnd=y+1+v.length;n(w);e(w.ta).focus()}function i(u){e(u.list).delegate("li","click",function(w){var v=this;d(v,u);w.stopPropagation();w.preventDefault();return false});e(u.ta).blur(function(v){setTimeout(function(){n(u)},400)});e(u.ta).click(function(v){n(u)});e(u.ta).keydown(function(v){if(u.listVisible){switch(v.keyCode){case 13:case 40:case 38:v.stopImmediatePropagation();v.preventDefault();return false;case 27:n(u)}}});e(u.ta).keyup(function(w){if(u.listVisible){if(w.keyCode==40){o(+1,u);w.stopImmediatePropagation();w.preventDefault();return false}if(w.keyCode==38){o(-1,u);w.stopImmediatePropagation();w.preventDefault();return false}if(w.keyCode==13){var v=k(u);if(v){w.stopImmediatePropagation();w.preventDefault();n(u);d(v,u);return false}n(u)}if(w.keyCode==27){w.stopImmediatePropagation();w.preventDefault();return false}}switch(w.keyCode){case 27:return true}var x=b(u);if(x!=""){u.on.query(x,function(y){if(y.length){h(u,x,y)}else{n(u)}})}else{n(u)}});e(u.ta).scroll(function(x){var w=x.target;var v=e(u.clone);v.get(0).scrollTop=w.scrollTop})}})(jQuery);